<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation Results</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="./static/sidebar.css">
    <link rel="stylesheet" href="./static/result.css">
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const clusterData = JSON.parse(document.getElementById("cluster-data").textContent);
            const totalClusters = clusterData.length;
            let currentCluster = 0;

            const updateClusterDisplay = () => {
                const cluster = clusterData[currentCluster];
                document.getElementById("cluster-title").textContent = `Cluster ${currentCluster + 1} of ${totalClusters}`;
                document.getElementById("cluster-content").src = cluster.content;

                // Update images
                const images = document.getElementById("cluster-images");
                images.innerHTML = `
                    <tr>
                        <td><img src="${cluster.images[0]}" alt="3D Temporal Factors"></td>
                        <td><img src="${cluster.images[1]}" alt="3D Instantaneous Factors"></td>
                    </tr>
                    <tr>
                        <td><img src="${cluster.images[2]}" alt="2D Temporal Factors"></td>
                        <td><img src="${cluster.images[3]}" alt="2D Instantaneous Factors"></td>
                    </tr>
                `;

                // Extract agent names from agent_name array
                const agentNames = cluster.agent_name.map((agent) => `<th>${agent[0]}</th>`).join("");

                // Update agent names and interests table
                const interests = cluster.interests.map((interest) => `<td>${interest}</td>`).join("");
                document.getElementById("cluster-interests").innerHTML = `
                    <thead>
                        <tr>${agentNames}</tr>
                    </thead>
                    <tbody>
                        <tr>${interests}</tr>
                    </tbody>
                `;

                // Update agent names and cultures table
                const cultures = cluster.cultures.map((culture) => `<td>${culture}</td>`).join("");
                document.getElementById("cluster-cultures").innerHTML = `
                    <thead>
                        <tr>${agentNames}</tr>
                    </thead>
                    <tbody>
                        <tr>${cultures}</tr>
                    </tbody>
                `;
            };

            document.getElementById("prev-btn").addEventListener("click", () => {
                if (currentCluster > 0) {
                    currentCluster--;
                    updateClusterDisplay();
                }
            });

            document.getElementById("next-btn").addEventListener("click", () => {
                if (currentCluster < totalClusters - 1) {
                    currentCluster++;
                    updateClusterDisplay();
                }
            });

            // Initialize display
            updateClusterDisplay();
        });
    </script>


</head>

<body class="bg-dark">
    <div class="sidebar">
        <a href="/simhome">Home</a>
        <a href="/register">Register</a>
        <a href="/result" class="active">Result</a>
    </div>
    <div class="main-content">
        <div class="container mt-5">
            <div class="main-head">
                <h1 id="cluster-title">Simulation Results</h1>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Cluster Details</h2>
                </div>
                <div>
                    <iframe id="cluster-content" width="100%" height="400" frameborder="0"></iframe>
                </div>
                <div class="card-body">
                    <table id="cluster-images"></table>

                    <h4>Agent Interests</h4>
                    <table id="cluster-interests"></table>

                    <h4>Agent Cultural Values</h4>
                    <table id="cluster-cultures"></table>
                </div>
            </div>

            <div class="navigation mt-4">
                <button id="prev-btn" class="btn btn-primary">Previous Cluster</button>
                <button id="next-btn" class="btn btn-primary">Next Cluster</button>
            </div>
        </div>
    </div>

    <!-- Hidden div to pass data -->
    <script type="application/json" id="cluster-data">
        {{ cluster_data | tojson }}
    </script>
</body>

</html>